############################################################
###
###   montage.sh
###
###  
###   HISTORY:
###       Ver. 1  (06/16/2024)
###
###
###         Dr. Hansung B. Gim
###             hansung.b.gim@gmail.com
###
############################################################

This program is designed to generate the image montages by combining cutouts from radio, HST, and JWST images 
using the Astrocut program. It runs six python scripts sequentially and removes byproduct files. 
Users need to modify the "main_config.yaml" file for input parameters and files. 
This program uses the following python libraries: Astrocut, Astropy, Scipy, Matplotlib, Numpy, Pandas, PyPDF2, pdf2image, pillow, and Reportlab. This program works with the most up-to-date versions of libraries within Python 3.12.3. 

Please reach out to me (hansung.b.gim@gmail.com) if you have any questions. 

0. Prerequisite Python packages 

  The following packages should be installed: astrocut v0.11.0, astropy v6.1.0, scipy v1.13.0, matplotlib v3.9.0, numpy v1.26.4, pandas v2.2.2, PyPDF2 v3.0.1, pdf2image v1.17.0, pillow v10.3.0, and reportlab v4.2.0
   
1. Usage
  > ./montage.sh

2. Input data file

  The input data file should be in comma-separated values (CSV) format and include column names such as ID, RA, DEC, Major, Minor, and PA. 

  

3. main_config.yaml
   
  This file is the input file that will be read by the subscripts. It is encoded in YAML. In this file, users set global parameters and global files. For the global parameters, users are required to set the cutout size in arcseconds (size_arcsec), positions (bottom left and top right) for cropping (crop_box), rescaled size of cutouts in pixels (target_size), and the number of figures per page (number_figures_per_page). For the global files, users provide the catalog file including ID, RA, DEC, Major (Major Axis), Minor (Minor Axis), PA (Position Angle) of radio sources, as well as the radio FITS image file, HST image files, and JWST image files. Here, the radio FITS image file must have two (2) dimensions to work with the astrocut. Astrocut cannot handle three- or four-dimensional FITS image files, while most radio FITS image files have four (4) dimensions including RA, DEC, Frequency, and Stokes. Users must reduce the dimensions of radio FITS image to TWO. 




4. Subscripts
   
  (1) montage_radio.py

  This script makes the cutouts from the radio image and saves them to a pdf. The outfile name is montage_{ID}_0.pdf


  (2) montage_optical.py
     
  This script generates cutouts from the HST and JWST images and saves them to a pdf. The output file names are montage_{ID}_N.pdf, where N is the sequence of optical images. 


  (3) pdf_crop_resize.py
     
  This script crops and resizes the cutouts generated by montage_radio.py and montage_optical.py. The cutout images created by these scripts have white spaces around the images, so this script crops the images with the predefined bottom left and top right pixel positions. The output file name is montage_{ID}_N_cropped.pdf, where N is the sequence of images. 

  (4) pdf_combine.py
     
  This script combines the cropped and resized images in the same row. The output file name is montage_{ID}_combination.pdf


  (5) pdf_generating_figure.py

  This script generates a PDF file including multiple combined figures on the same page. The number of IDs included on the same page is set by "number_figures_per_page" in the main_config.yaml


  (6) clear_files.py
     
  This script removes the files produced by running montage_radio.py, montage_optical.py, and pdf_crop_resize.py. For example, files named "montage_{ID}_N.pdf" and "montage_{ID}_N_cropped.pdf" are deleted.




